#!/usr/bin/env python
# coding: utf-8

# In[ ]:


import numpy as np
from math import cos, sin


# In[ ]:


# Space robot parameters
pi = 3.14159
p1 = 0.3696    # manipulator mounting point in x axis
p2 = 0.001279  # manipulator mounting point in y axis
a1 = 0.1805    # center of mass of the first link
a2 = 0.2000    # center of mass of the second link
a3 = 0.1029    # center of mass of the third link
L1 = 0.4488    # the length of the first link
L2 = 0.4499    # the length of the second link
L3 = 0.3545    # the length of the third link
m0 = 64.859    # the mass of the satellite
m1 = 2.9130    # the mass of the first kinematic pair
m2 = 2.6460    # the mass of the second kinematic pair
m3 = 1.6990    # the mass of the third kinematic pair
I0 = 2.6952    # Satellite moment of inertia
I1 = 0.091391  # Moment of inertia of the first kinematic pair
I2 = 0.081375  # Moment of inertia of the second kinematic pair
I3 = 0.021904  # Moment of inertia of the third kinematic pair
d  = 0.3536    # Distance from base geometry center to each corner


# In[ ]:


# Hyper parameters
dt = 0.01
nstep = 500


# In[ ]:


def kinematics(state):
    EE = np.zeros(3)
    Jacobian = np.zeros((3,6))
    EE[0] = state[0] + p1*cos(state[2]) - p2*sin(state[2]) + L1*cos(state[2]+state[3]) + L2*cos(state[2]+state[3]+state[4]) + L3*cos(state[2]+state[3]+state[4]+state[5]);
    EE[1] = state[1] + p1*sin(state[2]) + p2*cos(state[2]) + L1*sin(state[2]+state[3]) + L2*sin(state[2]+state[3]+state[4]) + L3*sin(state[2]+state[3]+state[4]+state[5]);
    EE[2] = state[2] + state[3] + state[4] + state[5];
    Jacobian[0][0] = 1;
    Jacobian[0][1] = 0;
    Jacobian[0][2] = - L3*sin(state[2]+state[3]+state[4]+state[5]) - L1*sin(state[2]+state[3]) - p2*cos(state[2]) - p1*sin(state[2]) - L2*sin(state[2]+state[3]+state[4]);
    Jacobian[0][3] = - L3*sin(state[2]+state[3]+state[4]+state[5]) - L1*sin(state[2]+state[3]) - L2*sin(state[2]+state[3]+state[4]);
    Jacobian[0][4] = - L3*sin(state[2]+state[3]+state[4]+state[5]) - L2*sin(state[2]+state[3]+state[4]);
    Jacobian[0][5] = - L3*sin(state[2]+state[3]+state[4]+state[5]);
    Jacobian[1][0] = 0;
    Jacobian[1][1] = 1;
    Jacobian[1][2] = L3*cos(state[2]+state[3]+state[4]+state[5]) + L1*cos(state[2]+state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2]+state[3]+state[4]);
    Jacobian[1][3] = L3*cos(state[2]+state[3]+state[4]+state[5]) + L1*cos(state[2]+state[3]) + L2*cos(state[2]+state[3]+state[4]);
    Jacobian[1][4] = L3*cos(state[2]+state[3]+state[4]+state[5]) + L2*cos(state[2]+state[3]+state[4]);
    Jacobian[1][5] = L3*cos(state[2]+state[3]+state[4]+state[5]);
    Jacobian[2][0] = 0;
    Jacobian[2][1] = 0;
    Jacobian[2][2] = 1;
    Jacobian[2][3] = 1;
    Jacobian[2][4] = 1;
    Jacobian[2][5] = 1;
    return EE, Jacobian


# In[ ]:


def dynamics(state):
    J0v = np.zeros((2,6))
    J0w = np.zeros((1,6))
    J1v = np.zeros((2,6))
    J1w = np.zeros((1,6))
    J2v = np.zeros((2,6))
    J2w = np.zeros((1,6))
    J3v = np.zeros((2,6))
    J3w = np.zeros((1,6))
    C = np.zeros((6,1))
    J0v = [[1, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 0]]
    J0vt = np.transpose(J0v)
    J0w = [[0, 0, 1, 0, 0, 0]]
    J0wt = np.transpose(J0w)
    var1 = - p1*sin(state[2]) -p2*cos(state[2]) - a1*sin(state[2]+state[3])
    var2 = -a1*sin(state[2]+state[3])
    var3 = -p2*sin(state[2]) + p1*cos(state[2])+a1*cos(state[3]+state[2])
    var4 = a1*cos(state[3]+state[2])
    J1v = [[1, 0, var1, var2, 0, 0],[0, 1, var3, var4, 0, 0]];
    J1vt = np.transpose(J1v)  
    J1w = [[0, 0, 1, 1, 0, 0]]
    J1wt = np.transpose(J1w)
    var5 = -p2*cos(state[2]) - L1*sin(state[3]+state[2]) - p1*sin(state[2]) - a2*sin(state[3]+state[4]+state[2]);
    var6 = -L1*sin(state[3]+state[2]) - a2*sin(state[3]+state[4]+state[2]);
    var7 = -a2*sin(state[3]+state[4]+state[2]);
    var8 = -p2*sin(state[2]) + a2*cos(state[3]+state[4]+state[2]) + L1*cos(state[3]+state[2])+p1*cos(state[2]);
    var9 =  a2*cos(state[3]+state[4]+state[2]) + L1*cos(state[3]+state[2]);
    var10 = a2*cos(state[3]+state[4]+state[2]);
    J2v = [[1, 0, var5, var6, var7, 0],[0, 1, var8, var9, var10, 0]]   
    J2vt = np.transpose(J2v)  
    J2w = [[0, 0, 1, 1, 1, 0]]
    J2wt = np.transpose(J2w)
    var11 = -p2*cos(state[2]) - L1*sin(state[3]+state[2]) - p1*sin(state[2]) - L2*sin(state[3]+state[4]+state[2]) -a3*sin(state[2]+state[3]+state[4]+state[5]);
    var12 = -L1*sin(state[3]+state[2]) - L2*sin(state[3]+state[4]+state[2]) - a3*sin(state[3]+state[4]+state[2]+state[5]);
    var13 = -L2*sin(state[3]+state[4]+state[2]) - a3*sin(state[3]+state[4]+state[2]+state[5]);
    var14 = -a3*sin(state[3]+state[4]+state[2]+state[5]);
    var15 = -p2*sin(state[2]) + L2*cos(state[3]+state[4]+state[2]) + L1*cos(state[3]+state[2])+p1*cos(state[2]) + a3*cos(state[2]+state[3]+state[4]+state[5]);
    var16 =  L2*cos(state[3]+state[4]+state[2]) + L1*cos(state[3]+state[2]) + a3*cos(state[2]+state[3]+state[4]+state[5]);
    var17 =  L2*cos(state[3]+state[4]+state[2]) + a3*cos(state[2]+state[3]+state[4]+state[5]);
    var18 =  a3*cos(state[2]+state[3]+state[4]+state[5]);
    J3v = [[1, 0, var11, var12, var13, var14],[0, 1, var15, var16, var17, var18]]
    J3vt = np.transpose(J3v)
    J3w = [[0, 0, 1, 1, 1, 1]]
    J3wt = np.transpose(J3w)
    Tv = np.matmul(m0*J0vt,J0v) +  np.matmul(m1*J1vt,J1v) +  np.matmul(m2*J2vt,J2v) +  np.matmul(m3*J3vt,J3v)
    Tw = J0wt*I0*J0w +  J1wt*I1*J1w +  J2wt*I2*J2w + J3wt*I3*J3w;
    M  = Tv+Tw;
    C[0][0] = - state[10]*(state[8]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[9]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[10]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + a3*m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])) - state[8]*(state[8]*(m2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]))) + state[10]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[9]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + a3*m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])) - state[9]*(state[10]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[8]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + state[9]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + a3*m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])) - state[11]*(a3*m3*state[8]*cos(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[9]*cos(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[10]*cos(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[11]*cos(state[2] + state[3] + state[4] + state[5]));
    C[1][0] = - state[11]*(a3*m3*state[8]*sin(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[9]*sin(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[10]*sin(state[2] + state[3] + state[4] + state[5]) + a3*m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])) - state[8]*(state[9]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) + state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[8]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + m2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) + m1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]))) + a3*m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])) - state[9]*(state[8]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) + state[9]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) + state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + a3*m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])) - state[10]*(state[8]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[9]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + a3*m3*state[11]*sin(state[2] + state[3] + state[4] + state[5]));
    C[2][0] = (state[9]*(state[6]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + state[7]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3]))))/2 - state[8]*(state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4]))) - state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4]))*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m1*cos(state[2] + state[3])*a1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])) - m1*sin(state[2] + state[3])*a1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2])) + a1*m1*cos(state[2] + state[3])*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1) - a1*m1*sin(state[2] + state[3])*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1))) - state[6]*(state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m1*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1) + m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2)) + m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])*a3) - state[7]*(state[8]*(m2*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m1*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1)) + state[9]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])*a3) + (state[11]*(a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[11]*(state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1))) - state[9]*(state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) - state[9]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4]))*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + a1*m1*cos(state[2] + state[3])*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1) - a1*m1*sin(state[2] + state[3])*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1) + a1*m1*cos(state[2] + state[3])*sin(state[2] + state[3])*a1 - a1*m1*sin(state[2] + state[3])*cos(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1))) + (state[10]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4]))))/2 - state[10]*(state[9]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) + state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])))) + (state[8]*(state[6]*(m2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]))) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + m2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) + m1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])))))/2 + (state[6]*(state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m1*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1) + m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2)) + state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + (state[7]*(state[9]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[8]*(m2*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m1*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1)) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2;
    C[3][0] = (state[10]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[8]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1))))/2 - state[11]*(state[10]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3)) - state[10]*(state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) + state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1))) - (state[8]*(state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) - state[6]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + state[8]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4]))*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m1*cos(state[2] + state[3])*a1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])) - m1*sin(state[2] + state[3])*a1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2])) + a1*m1*cos(state[2] + state[3])*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1) - a1*m1*sin(state[2] + state[3])*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1)) + state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m1*cos(state[2] + state[3])*a1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])) - m1*sin(state[2] + state[3])*a1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2])) - a1*m1*cos(state[2] + state[3])*sin(state[2] + state[3])*a1 + a1*m1*sin(state[2] + state[3])*cos(state[2] + state[3])*a1) - state[7]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])))))/2 + (state[6]*(state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + (state[7]*(state[8]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[9]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + (state[11]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[9]*(state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1))) - state[6]*(state[8]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) + m1*cos(state[2] + state[3])*a1) + state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])*a3) - state[7]*(state[8]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[9]*(m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m1*sin(state[2] + state[3])*a1) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])*a3) - state[8]*(state[10]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4]))) - state[9]*(m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m1*cos(state[2] + state[3])*a1*(a1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2])) - m1*sin(state[2] + state[3])*a1*(a1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2])) - a1*m1*cos(state[2] + state[3])*sin(state[2] + state[3])*a1 + a1*m1*sin(state[2] + state[3])*cos(state[2] + state[3])*a1) + state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])))) + (state[9]*(state[6]*(m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + a1*m1*cos(state[2] + state[3])) + state[7]*(m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a1*m1*sin(state[2] + state[3])) - state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4]))*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m2*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1)*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - m2*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + a1*m1*cos(state[2] + state[3])*(cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*a1) - a1*m1*sin(state[2] + state[3])*(cos(state[2])*p1 - sin(state[2])*p2 + cos(state[2] + state[3])*a1) + a1*m1*cos(state[2] + state[3])*sin(state[2] + state[3])*a1 - a1*m1*sin(state[2] + state[3])*cos(state[2] + state[3])*a1)))/2;
    C[4][0] = (state[8]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) - state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4]))) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) - state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[9]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])))))/2 - state[7]*(state[8]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])*a3) + state[9]*(state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) - state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2))) - state[11]**2*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + (state[9]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1)) - state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) - state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) + state[8]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1))))/2 - state[6]*(state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[9]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])*a3) + (state[7]*(state[8]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m2*sin(state[2] + state[3] + state[4])*a2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + state[8]*(state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + a2*cos(state[2] + state[3] + state[4])) - m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + a2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4]))) - state[11]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[10]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2)*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) - m2*sin(state[2] + state[3] + state[4])*a2*(L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + a2*cos(state[2] + state[3] + state[4])) + m2*cos(state[2] + state[3] + state[4])*a2*(L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + a2*sin(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2)) + (state[10]*(state[6]*(m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a2*m2*cos(state[2] + state[3] + state[4])) + state[7]*(m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a2*m2*sin(state[2] + state[3] + state[4])) + state[9]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2] + state[3])*L1) - a2*m2*cos(state[2] + state[3] + state[4])*(sin(state[2] + state[3] + state[4])*a2 + sin(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2) + state[8]*(m3*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - m3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4]))*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a2*m2*sin(state[2] + state[3] + state[4])*(cos(state[2] + state[3] + state[4])*a2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a2*m2*cos(state[2] + state[3] + state[4])*(cos(state[2])*p2 + sin(state[2] + state[3] + state[4])*a2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + a2*m2*cos(state[2] + state[3] + state[4])*sin(state[2] + state[3] + state[4])*a2 - a2*m2*sin(state[2] + state[3] + state[4])*cos(state[2] + state[3] + state[4])*a2)))/2 + (state[11]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 + (state[6]*(state[8]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[9]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + state[10]*(m3*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) + m2*cos(state[2] + state[3] + state[4])*a2) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 - state[10]*state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2));
    C[5][0] = (state[10]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4]))) + state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[9]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1)) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[9]*(state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) - state[10]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])))) + (state[6]*(m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[8] + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[9] + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[10] + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 + state[8]*(state[10]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) - state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[9]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) - m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) + m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])))) + (state[7]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[8] + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[9] + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[10] + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*state[11]))/2 - state[6]*(m3*state[8]*cos(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[9]*cos(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[10]*cos(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[11]*cos(state[2] + state[3] + state[4] + state[5])*a3) + (state[8]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + p1*cos(state[2]) - p2*sin(state[2]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + p2*cos(state[2]) + p1*sin(state[2]) + L2*sin(state[2] + state[3] + state[4]))) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[7]*(m3*state[8]*sin(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[9]*sin(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[10]*sin(state[2] + state[3] + state[4] + state[5])*a3 + m3*state[11]*sin(state[2] + state[3] + state[4] + state[5])*a3) + (state[11]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 + (state[9]*(state[8]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2])*p1 + cos(state[2] + state[3])*L1 - sin(state[2])*p2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + cos(state[2])*p2 + sin(state[2])*p1 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) + state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3) + state[10]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2)) + state[9]*(a3*m3*sin(state[2] + state[3] + state[4] + state[5])*(cos(state[2] + state[3] + state[4] + state[5])*a3 + cos(state[2] + state[3] + state[4])*L2 + cos(state[2] + state[3])*L1) - a3*m3*cos(state[2] + state[3] + state[4] + state[5])*(sin(state[2] + state[3] + state[4] + state[5])*a3 + sin(state[2] + state[3] + state[4])*L2 + sin(state[2] + state[3])*L1) + m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L1*cos(state[2] + state[3]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L1*sin(state[2] + state[3]) + L2*sin(state[2] + state[3] + state[4]))) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*state[6] + a3*m3*sin(state[2] + state[3] + state[4] + state[5])*state[7]))/2 - state[10]*state[11]*(m3*sin(state[2] + state[3] + state[4] + state[5])*a3*(a3*cos(state[2] + state[3] + state[4] + state[5]) + L2*cos(state[2] + state[3] + state[4])) - m3*cos(state[2] + state[3] + state[4] + state[5])*a3*(a3*sin(state[2] + state[3] + state[4] + state[5]) + L2*sin(state[2] + state[3] + state[4])) + a3*m3*cos(state[2] + state[3] + state[4] + state[5])*sin(state[2] + state[3] + state[4] + state[5])*a3 - a3*m3*sin(state[2] + state[3] + state[4] + state[5])*cos(state[2] + state[3] + state[4] + state[5])*a3);
    return M, C


# In[ ]:


def distance(ini_pos, fin_pos):
    dist = (ini_pos[0]-fin_pos[0])**2 + (ini_pos[1]-fin_pos[1])**2 
    dist = np.sqrt(dist)
    return dist


# In[ ]:


def step(state, action, ee_final):
    
    action = action.numpy()
    x = state
    old_x = x
    old_EE, old_Jacobian = kinematics(x)
    q  = np.array([[state[0]], [state[1]], [state[2]], [state[3]], [state[4]], [state[5]]])
    M, C = dynamics(x)
    rsT = [[-state[1], state[0]]]
    Ms_11 = M[0:2,0:2]
    Ms_12 = M[0:2,2]
    Ms_12 = Ms_12.reshape((2, 1))
    MsT_12 = np.transpose(Ms_12)
    Ms_22 = M[2,2]
    H1[0:2,0:2] = Ms_11 
    H1[0:2,2:3] = Ms_12
    H1[2:3,0:2] = MsT_12 + np.matmul(rsT,Ms_11)
    H1[2,2] = Ms_22 + np.matmul(rsT,Ms_12)
    H1inv = np.linalg.inv(H1) 
    Msm_11 = M[0:2,3:6]
    Msm_21 = M[2:3,3:6]
    H2[0:2,0:3] = Msm_11
    H2[2:3,0:3] = Msm_21 + np.matmul(rsT,Msm_11)
    teta_prim = [[action[0]], [action[1]], [action[2]]]
    sat_vel = np.matmul(np.matmul(-H1inv,H2),teta_prim)
    dq = np.vstack([sat_vel,teta_prim])
    k1 = dt*dq
    k2 = dt*(dq + 0.5*k1)
    k3 = dt*(dq + 0.5*k2)
    k4 = dt*(dq + k3)
    q = q + (k1 + 2*k2 + 2*k3 + k4)/6    
    new_x = [q[0], q[1],  q[2],  q[3],  q[4],  q[5], dq[0], dq[1], dq[2], dq[3], dq[4], dq[5]]  
    new_EE, Jacobian = kinematics(new_x)
    
    ini_pos = [ee_final[0], ee_final[1], ee_final[2]]
    fin_pos = [new_EE[0], new_EE[1], new_EE[2]]
            
    done = 0
    reward = -distance(ini_pos, fin_pos)
    
    if abs(ee_final_x-new_EE[0])<0.001 and abs(ee_final_y-new_EE[1])<0.001:
        done = 1
        reward = 0
         
    new_x = np.array([q[0], q[1],  q[2],  q[3],  q[4],  q[5], dq[0], dq[1], dq[2], dq[3], dq[4], dq[5]])
    new_x = new_x.reshape(12,)
    return new_x, new_EE, done, reward   

